"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function load(e,t){var r=_q2["default"].defer(),n=[],o=t.urls.hubpress;return _superagent2["default"].get(o+"/themes/"+e+"/theme.json?dt="+Date.now()).end(function(t,a){if(t)return void r.reject(t);var s=a.body,u=s.version,i=_lodash2["default"].toPairs(s.files),l=!1,p=!1,d=!1;i.forEach(function(t){var r=_q2["default"].defer();n.push(r.promise),l=l||"pagination"===t[0],p=p||"nav"===t[0],d=d||"navigation"===t[0],_superagent2["default"].get(o+"/themes/"+e+"/"+t[1]+"?v="+u).end(function(e,n){return e?void r.reject(e):void r.resolve({name:t[0],path:t[1],content:n.text})})}),l||!function(){var e=_q2["default"].defer();n.push(e.promise),_superagent2["default"].get(o+"/hubpress/scripts/helpers/tpl/pagination.hbs").end(function(t,r){return t?void e.reject(t):void e.resolve({name:"pagination",path:"partials/pagination",content:r.text})})}(),p||!function(){var e=_q2["default"].defer();n.push(e.promise),_superagent2["default"].get(o+"/hubpress/scripts/helpers/tpl/nav.hbs").end(function(t,r){return t?void e.reject(t):void e.resolve({name:"nav",path:"partials/nav",content:r.text})})}(),d||!function(){var e=_q2["default"].defer();n.push(e.promise),_superagent2["default"].get(o+"/hubpress/scripts/helpers/tpl/navigation.hbs").end(function(t,r){return t?void e.reject(t):void e.resolve({name:"navigation",path:"partials/navigation",content:r.text})})}(),_q2["default"].all(n).then(function(e){r.resolve({version:u,files:e})})["catch"](function(e){console.log(e),r.reject(e)})}),r.promise}function templatePlugin(e){e.on("requestTheme",function(e){console.log("Theme plugin",e);var t=e.data.config.theme.name.toLowerCase();return load(t,e.data.config).then(function(r){var n={name:t,files:r.files,version:r.version};_builder2["default"].registerTheme(e.data.config,n),_builder2["default"].registerFiles(n.files);var o=Object.assign({},n),a=Object.assign({},e.data,{theme:o});return Object.assign({},e,{data:a})})}),e.on("requestGenerateIndex",function(e){return console.info("Template Plugin - requestGenerateIndex"),console.log("requestGenerateIndex",e),(0,_indexGenerator.generateIndex)(e)}),e.on("requestGeneratePost",function(e){return console.info("Template Plugin - requestGeneratePost"),console.log("requestGeneratePost",e),(0,_postGenerator.generatePost)(e,e.data.post)}),e.on("requestGeneratePosts",function(e){return console.info("Template Plugin - requestGeneratePosts"),console.log("requestGeneratePosts",e),(0,_postsGenerator.generatePosts)(e,e.data.post)}),e.on("requestGenerateTags",function(e){return console.info("Template Plugin - requestGenerateTags"),console.log("requestGenerateTags",e),(0,_tagsGenerator.generateTags)(e,e.data.post)}),e.on("requestGenerateAuthors",function(e){return console.info("Template Plugin - requestGenerateAuthors"),console.log("requestGenerateAuthors",e),(0,_authorsGenerator.generateAuthors)(e,e.data.post)})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.templatePlugin=templatePlugin;var _q=require("q"),_q2=_interopRequireDefault(_q),_superagent=require("superagent"),_superagent2=_interopRequireDefault(_superagent),_lodash=require("lodash"),_lodash2=_interopRequireDefault(_lodash),_indexGenerator=require("./indexGenerator"),_postGenerator=require("./postGenerator"),_postsGenerator=require("./postsGenerator"),_tagsGenerator=require("./tagsGenerator"),_authorsGenerator=require("./authorsGenerator"),_builder=require("./builder"),_builder2=_interopRequireDefault(_builder);