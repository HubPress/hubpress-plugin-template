"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),_handlebars=require("handlebars"),_handlebars2=_interopRequireDefault(_handlebars),_helpers=require("./helpers"),_helpers2=_interopRequireDefault(_helpers),_config=require("./config"),_config2=_interopRequireDefault(_config),Builder=function(){function e(){_classCallCheck(this,e),this.name=null,this.version=null,this.templateCache=new Map,this.templateOptions={data:{}},_helpers2["default"].loadCoreHelpers()}return _createClass(e,[{key:"registerTheme",value:function(e,t){this.setThemeName(t.name),this.setThemeVersion(t.version),this.registerFiles(t.files);var a=e.site||{};a.url=e.urls.site,a.navigation=[],this.templateOptions={data:{blog:a}}}},{key:"registerFiles",value:function(e){var t=this;console.info("Builder - registerFiles"),console.log("Builder - registerFiles",e);var a=/{{!<\s+([A-Za-z0-9\._\-\/]+)\s*}}/;e.forEach(function(e){if(0===e.path.indexOf("partials/"))_handlebars2["default"].registerPartial(e.name,e.content);else{var n={name:e.name,template:_handlebars2["default"].compile(e.content)},l=e.content.match(a);l&&(n.layout=l[1]),t.templateCache.set(e.name,n)}})}},{key:"template",value:function(e,t,a){console.info("Builder - template"),console.log("Builder - template",e,t,a),_config2["default"].set(a);var n=this.templateCache.get(e),l=n.template(t,this.templateOptions);return n.layout&&(t.body=l,n=this.templateCache.get(n.layout),l=n.template(t,this.templateOptions)),l}},{key:"setThemeName",value:function(e){this.name=e}},{key:"getThemeName",value:function(){return this.name}},{key:"getThemeVersion",value:function(){return this.version}},{key:"setThemeVersion",value:function(e){this.version=e}},{key:"isTemplateAvailable",value:function(e){return this.templateCache.get(e)}}]),e}();exports["default"]=new Builder,module.exports=exports["default"];