"use strict";function setConfig(e){ghostConfig=e}function getBaseUrl(e){return e&&ghostConfig.urlSSL?ghostConfig.urlSSL:e?ghostConfig.url.replace("http://","https://"):ghostConfig.url}function urlJoin(){var e,t,r=Array.prototype.slice.call(arguments),o=!1,s=ghostConfig.paths.subdir.replace(/\//g,"");return""===r[0]&&r.shift(),0===r[0].indexOf("//")&&(o=!0),t=r.join("/"),t=t.replace(/(^|[^:])\/\/+/g,"$1/"),o&&(t=t.replace(/^\//,"//")),s&&(e=new RegExp(s+"/"+s+"/"),t=t.replace(e,s+"/")),t}function createUrl(e,t,r){e=e||"/",t=t||!1;var o;return o=t?getBaseUrl(r):ghostConfig.paths.subdir,urlJoin(o,e)}function urlPathForPost(e){var t="",r=ghostConfig.theme.permalinks,o={year:function(){return moment(e.published_at).format("YYYY")},month:function(){return moment(e.published_at).format("MM")},day:function(){return moment(e.published_at).format("DD")},author:function(){return e.author.slug},slug:function(){return e.slug},id:function(){return e.id}};return t+=e.page?"/:slug/":r,t=t.replace(/(:[a-z]+)/g,function(e){return _.has(o,e.substr(1))?o[e.substr(1)]():void 0})}function urlFor(e,t,r){var o,s,i,n,a="/",u=["post","tag","author","image","nav"],g={home:"/",rss:"/rss/",api:apiPath,sitemap_xsl:"/sitemap.xsl"};if(_.isBoolean(t)&&(r=t,t=null),o=e&&e.secure||t&&t.secure,_.isObject(e)&&e.relativeUrl)a=e.relativeUrl;else if(_.isString(e)&&-1!==_.indexOf(u,e))if("post"===e&&t.post)a=urlJoin(getBaseUrl(),"/",t.post.url),o=t.secure;else if("tag"===e&&t.tag)a=urlJoin(getBaseUrl(),"/",ghostConfig.routeKeywords.tag,t.tag.slug,"/"),o=t.tag.secure;else if("author"===e&&t.author)a=urlJoin(getBaseUrl(),"/",ghostConfig.routeKeywords.author,t.author.slug,"/"),o=t.author.secure;else{if("image"===e&&t.image)return a=t.image,s=new RegExp("^"+ghostConfig.paths.subdir+"/"+ghostConfig.paths.imagesRelPath),r=s.test(t.image)?r:!1,o=t.image.secure,r&&(a=a.replace(new RegExp("^"+ghostConfig.paths.subdir),""),i=getBaseUrl(o).replace(/\/$/,""),a=i+a),a;"nav"===e&&t.nav&&(a=t.nav.url,o=t.nav.secure||o,i=getBaseUrl(o),n=i.split("//")[1]+ghostConfig.paths.subdir,a.indexOf(n)>-1&&-1===a.indexOf("."+n)&&0!==a.indexOf("mailto:")&&(a=a.split(n)[1],"/"!==a.substring(0,1)&&(a="/"+a),r=!0))}else _.isString(e)&&-1!==_.indexOf(_.keys(g),e)&&(a=g[e]||"/");return a&&(-1!==a.indexOf("://")||a.match(/^(\/\/|#|[a-zA-Z0-9\-]+:)/))?a:createUrl(a,r,o)}function apiUrl(){var e;return e=ghostConfig.forceAdminSSL?(ghostConfig.urlSSL||ghostConfig.url).replace(/^.*?:\/\//g,"https://"):ghostConfig.urlSSL?ghostConfig.urlSSL.replace(/^.*?:\/\//g,"https://"):ghostConfig.url.match(/^https:/)?ghostConfig.url:ghostConfig.url.replace(/^.*?:\/\//g,"//"),e.replace(/\/$/,"")+apiPath+"/"}var moment=require("moment"),_=require("lodash"),ghostConfig="",apiPath="/ghost/api/v0.1";module.exports.setConfig=setConfig,module.exports.urlJoin=urlJoin,module.exports.urlFor=urlFor,module.exports.urlPathForPost=urlPathForPost,module.exports.apiUrl=apiUrl,module.exports.getBaseUrl=getBaseUrl;